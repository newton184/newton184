<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fresh Fusion</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#5D5CDE',
            secondary: '#FF9900',
            dark: {
              bg: '#181818',
              card: '#222222',
              text: '#E5E5E5'
            }
          }
        }
      }
    }

    // Check for dark mode
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
  </script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    .product-card:hover {
      transform: translateY(-4px);
      transition: transform 0.3s ease;
    }
  </style>
</head>
<body class="bg-white dark:bg-dark-bg text-gray-800 dark:text-dark-text min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-primary text-white p-4 shadow-md">
    <div class="container mx-auto flex flex-col md:flex-row items-center justify-between">
      <div class="flex items-center mb-4 md:mb-0">
        <h1 class="text-2xl font-bold">Fresh fusion</h1>
      </div>
      
      <div class="w-full md:w-1/2 relative">
        <input 
          type="text" 
          placeholder="Search products..." 
          class="w-full p-2 rounded-md text-gray-800 text-base"
        >
        <button class="absolute right-2 top-2 text-gray-600">
          <i class="fas fa-search"></i>
        </button>
      </div>
      
      <div class="flex items-center mt-4 md:mt-0 space-x-4">
        <button id="account-btn" class="text-white hover:text-gray-200">
          <i class="fas fa-user"></i> <span id="account-status">Account</span>
        </button>
        <button id="cart-btn" class="text-white hover:text-gray-200 relative">
          <i class="fas fa-shopping-cart"></i>
          <span id="cart-count" class="absolute -top-2 -right-2 bg-secondary text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
        </button>
      </div>
    </div>
  </header>
  
  <!-- Navigation -->
  <nav class="bg-gray-100 dark:bg-dark-card shadow-sm">
    <div class="container mx-auto flex overflow-x-auto py-2">
      <a href="#" class="px-4 py-2 whitespace-nowrap hover:text-primary dark:hover:text-primary">Home</a>
      <a href="#" class="px-4 py-2 whitespace-nowrap hover:text-primary dark:hover:text-primary">Electronics</a>
      <a href="#" class="px-4 py-2 whitespace-nowrap hover:text-primary dark:hover:text-primary">Clothing</a>
      <a href="#" class="px-4 py-2 whitespace-nowrap hover:text-primary dark:hover:text-primary">Home & Kitchen</a>
      <a href="#" class="px-4 py-2 whitespace-nowrap hover:text-primary dark:hover:text-primary">Books</a>
      <a href="#" class="px-4 py-2 whitespace-nowrap hover:text-primary dark:hover:text-primary">Toys</a>
      <a href="#" class="px-4 py-2 whitespace-nowrap hover:text-primary dark:hover:text-primary">Sports</a>
      <a href="#" class="px-4 py-2 whitespace-nowrap hover:text-primary dark:hover:text-primary">Beauty</a>
    </div>
  </nav>
  
  <!-- Main Content -->
  <main class="flex-grow container mx-auto p-4">
    <!-- Hero Section -->
    <div class="bg-gray-200 dark:bg-dark-card rounded-lg p-6 mb-8 flex flex-col md:flex-row items-center">
      <div class="md:w-1/2 mb-4 md:mb-0">
        <h2 class="text-3xl font-bold mb-2">Karibu! Jibambe!</h2>
        <p class="mb-4">Discover amazing products with fast shipping and secure payments via PayPal and M-PESA.</p>
        <button class="bg-secondary hover:bg-yellow-600 text-white px-6 py-2 rounded-md transition">Shop Now</button>
      </div>
      <div class="md:w-1/2 flex justify-center">
        <div class="w-64 h-48 bg-gray-300 dark:bg-gray-700 rounded-lg flex items-center justify-center">
          <i class="fas fa-shopping-bag text-5xl text-gray-500 dark:text-gray-400"></i>
        </div>
      </div>
    </div>
    
    <!-- Featured Products -->
    <div class="mb-8">
      <h2 class="text-2xl font-bold mb-4">Featured Products</h2>
      <div id="products-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <!-- Products will be inserted here via JavaScript -->
      </div>
    </div>
  </main>
  
  <!-- Cart Sidebar -->
  <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full md:w-96 bg-white dark:bg-dark-card shadow-lg transform translate-x-full transition-transform duration-300 z-50 flex flex-col">
    <div class="p-4 bg-primary text-white flex justify-between items-center">
      <h2 class="text-xl font-bold">Your Cart</h2>
      <button id="close-cart" class="text-white hover:text-gray-200">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div id="cart-items" class="flex-grow overflow-y-auto p-4">
      <!-- Cart items will be added here -->
      <div class="text-center text-gray-500 dark:text-gray-400 py-8">
        Your cart is empty
      </div>
    </div>
    
    <div class="p-4 border-t border-gray-200 dark:border-gray-700">
      <div class="flex justify-between mb-4">
        <span class="font-bold">Total:</span>
        <span id="cart-total" class="font-bold">$0.00</span>
      </div>
      <button id="checkout-btn" class="w-full bg-secondary hover:bg-yellow-600 text-white py-2 rounded-md transition mb-2">
        Proceed to Checkout
      </button>
    </div>
  </div>
  
  <!-- Checkout Modal -->
  <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-dark-card rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <div class="p-4 bg-primary text-white flex justify-between items-center sticky top-0">
        <h2 class="text-xl font-bold">Checkout</h2>
        <button id="close-checkout" class="text-white hover:text-gray-200">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="p-6">
        <div class="mb-8">
          <h3 class="text-xl font-semibold mb-4">Shipping Information</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block mb-1">First Name</label>
              <input type="text" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
            </div>
            <div>
              <label class="block mb-1">Last Name</label>
              <input type="text" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
            </div>
            <div class="md:col-span-2">
              <label class="block mb-1">Address</label>
              <input type="text" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
            </div>
            <div>
              <label class="block mb-1">City</label>
              <input type="text" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
            </div>
            <div>
              <label class="block mb-1">Postal Code</label>
              <input type="text" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
            </div>
            <div class="md:col-span-2">
              <label class="block mb-1">Country</label>
              <select class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
                <option>United States</option>
                <option>Canada</option>
                <option>United Kingdom</option>
                <option>Kenya</option>
                <option>Tanzania</option>
                <option>Uganda</option>
                <option>Other</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="mb-8">
          <h3 class="text-xl font-semibold mb-4">Payment Method</h3>
          <div class="space-y-4">
            <div class="border rounded-md p-4 dark:border-gray-600 hover:border-primary dark:hover:border-primary cursor-pointer">
              <div class="flex items-center">
                <input type="radio" id="paypal" name="payment" class="mr-2" checked>
                <label for="paypal" class="flex items-center">
                  <i class="fab fa-paypal text-blue-600 text-2xl mr-2"></i>
                  <span>PayPal</span>
                </label>
              </div>
              <div class="ml-6 mt-2 text-sm text-gray-600 dark:text-gray-400">
                Pay securely using your PayPal account
              </div>
            </div>
            
            <div class="border rounded-md p-4 dark:border-gray-600 hover:border-primary dark:hover:border-primary cursor-pointer">
              <div class="flex items-center">
                <input type="radio" id="mpesa" name="payment" class="mr-2">
                <label for="mpesa" class="flex items-center">
                  <div class="w-8 h-8 bg-green-600 rounded-md flex items-center justify-center mr-2 text-white font-bold">M</div>
                  <span>M-PESA</span>
                </label>
              </div>
              <div id="mpesa-form" class="ml-6 mt-2 hidden">
                <div class="mb-2">
                  <label class="block mb-1 text-sm">Phone Number</label>
                  <input type="text" placeholder="e.g. 254712345678" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
                </div>
              </div>
              <div class="ml-6 mt-2 text-sm text-gray-600 dark:text-gray-400">
                Pay using M-PESA mobile money service
              </div>
            </div>
          </div>
        </div>
        
        <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
          <h3 class="text-xl font-semibold mb-4">Order Summary</h3>
          <div id="checkout-items" class="mb-4 space-y-2">
            <!-- Order items will be inserted here -->
          </div>
          
          <div class="flex justify-between font-bold text-lg">
            <span>Total:</span>
            <span id="checkout-total">$0.00</span>
          </div>
          
          <button id="place-order-btn" class="w-full bg-secondary hover:bg-yellow-600 text-white py-3 rounded-md transition mt-6 font-bold">
            Place Order
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Order Success Modal -->
  <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-dark-card rounded-lg w-full max-w-md p-6 text-center">
      <div class="text-green-500 text-6xl mb-4">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2 class="text-2xl font-bold mb-4">Order Placed Successfully!</h2>
      <p class="mb-6 text-gray-600 dark:text-gray-400">
        Thank you for your purchase. Your order has been received and is being processed.
      </p>
      <button id="continue-shopping" class="bg-primary hover:bg-indigo-700 text-white px-6 py-2 rounded-md transition">
        Continue Shopping
      </button>
    </div>
  </div>
  
  <!-- Account Modal (Login/Register) -->
  <div id="account-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-dark-card rounded-lg w-full max-w-md">
      <div class="flex border-b border-gray-200 dark:border-gray-700">
        <button id="login-tab" class="flex-1 py-4 px-6 font-semibold text-center border-b-2 border-primary">
          Login
        </button>
        <button id="register-tab" class="flex-1 py-4 px-6 font-semibold text-center border-b-2 border-transparent text-gray-500 dark:text-gray-400">
          Register
        </button>
        <button id="close-account" class="absolute right-4 top-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- Login Form -->
      <div id="login-form" class="p-6">
        <div class="mb-4">
          <label class="block mb-2">Email</label>
          <input type="email" id="login-email" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
        </div>
        <div class="mb-6">
          <label class="block mb-2">Password</label>
          <input type="password" id="login-password" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
        </div>
        <button id="login-btn" class="w-full bg-primary hover:bg-indigo-700 text-white py-2 rounded-md transition mb-4">
          Login
        </button>
        <div class="text-center text-sm text-gray-600 dark:text-gray-400">
          <a href="#" class="hover:text-primary">Forgot Password?</a>
        </div>
      </div>
      
      <!-- Register Form -->
      <div id="register-form" class="p-6 hidden">
        <div class="mb-4">
          <label class="block mb-2">Full Name</label>
          <input type="text" id="register-name" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
        </div>
        <div class="mb-4">
          <label class="block mb-2">Email</label>
          <input type="email" id="register-email" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
        </div>
        <div class="mb-4">
          <label class="block mb-2">Phone Number</label>
          <input type="tel" id="register-phone" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
        </div>
        <div class="mb-4">
          <label class="block mb-2">Password</label>
          <input type="password" id="register-password" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
        </div>
        <div class="mb-6">
          <label class="block mb-2">Confirm Password</label>
          <input type="password" id="register-confirm-password" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-base">
        </div>
        <div class="mb-6 flex items-start">
          <input type="checkbox" id="enable-2fa" class="mt-1 mr-2">
          <label for="enable-2fa" class="text-sm">Enable Two-Factor Authentication (2FA) for enhanced security</label>
        </div>
        <button id="register-btn" class="w-full bg-primary hover:bg-indigo-700 text-white py-2 rounded-md transition">
          Register
        </button>
      </div>
    </div>
  </div>
  
  <!-- 2FA Setup Modal -->
  <div id="setup-2fa-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-dark-card rounded-lg w-full max-w-md p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold">Set Up Two-Factor Authentication</h2>
        <button id="close-2fa-setup" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="mb-6">
        <p class="mb-4">Choose your preferred 2FA method:</p>
        <div class="space-y-3">
          <div class="flex items-center p-3 border rounded-md dark:border-gray-700 cursor-pointer hover:border-primary dark:hover:border-primary">
            <input type="radio" name="2fa-method" id="2fa-sms" class="mr-3" checked>
            <label for="2fa-sms" class="flex-grow cursor-pointer">
              <div class="font-medium">SMS Verification</div>
              <div class="text-sm text-gray-600 dark:text-gray-400">Receive verification codes via SMS</div>
            </label>
            <i class="fas fa-mobile-alt text-xl text-gray-500"></i>
          </div>
          
          <div class="flex items-center p-3 border rounded-md dark:border-gray-700 cursor-pointer hover:border-primary dark:hover:border-primary">
            <input type="radio" name="2fa-method" id="2fa-email" class="mr-3">
            <label for="2fa-email" class="flex-grow cursor-pointer">
              <div class="font-medium">Email Verification</div>
              <div class="text-sm text-gray-600 dark:text-gray-400">Receive verification codes via email</div>
            </label>
            <i class="fas fa-envelope text-xl text-gray-500"></i>
          </div>
          
          <div class="flex items-center p-3 border rounded-md dark:border-gray-700 cursor-pointer hover:border-primary dark:hover:border-primary">
            <input type="radio" name="2fa-method" id="2fa-app" class="mr-3">
            <label for="2fa-app" class="flex-grow cursor-pointer">
              <div class="font-medium">Authenticator App</div>
              <div class="text-sm text-gray-600 dark:text-gray-400">Use Google Authenticator or similar app</div>
            </label>
            <i class="fas fa-key text-xl text-gray-500"></i>
          </div>
        </div>
      </div>
      
      <div id="app-2fa-details" class="mb-6 hidden">
        <div class="text-center mb-4">
          <p class="mb-2">Scan this QR code with your authenticator app:</p>
          <div class="w-48 h-48 mx-auto bg-white p-2 rounded-md flex items-center justify-center">
            <!-- Simulated QR code -->
            <div class="w-40 h-40 bg-black relative overflow-hidden">
              <div class="absolute inset-0 grid grid-cols-5 grid-rows-5 gap-1">
                <!-- Static pattern that resembles a QR code -->
                <div class="bg-white"></div>
                <div class="bg-white"></div>
                <div class="bg-white"></div>
                <div class="bg-black"></div>
                <div class="bg-white"></div>
                <div class="bg-black"></div>
                <div class="bg-black"></div>
                <div class="bg-white"></div>
                <div class="bg-black"></div>
                <div class="bg-white"></div>
                <div class="bg-white"></div>
                <div class="bg-black"></div>
                <div class="bg-white"></div>
                <div class="bg-black"></div>
                <div class="bg-black"></div>
                <div class="bg-white"></div>
                <div class="bg-black"></div>
                <div class="bg-white"></div>
                <div class="bg-black"></div>
                <div class="bg-white"></div>
                <div class="bg-black"></div>
                <div class="bg-white"></div>
                <div class="bg-white"></div>
                <div class="bg-black"></div>
                <div class="bg-white"></div>
              </div>
            </div>
          </div>
        </div>
        <p class="text-sm text-gray-600 dark:text-gray-400 text-center mb-4">
          Or enter this setup key manually:
        </p>
        <div class="bg-gray-100 dark:bg-gray-800 p-2 rounded-md text-center font-mono mb-4">
          FR3SH-4SI0N-3AXZ9-FG721
        </div>
      </div>
      
      <div id="2fa-verify" class="mb-6">
        <p class="mb-4" id="2fa-verify-text">We'll send a verification code to your phone number to verify your 2FA setup.</p>
        <button id="send-code-btn" class="w-full bg-primary hover:bg-indigo-700 text-white py-2 rounded-md transition mb-4">
          Send Verification Code
        </button>
        
        <div id="verify-code-section" class="hidden">
          <label class="block mb-2">Enter Verification Code</label>
          <div class="flex justify-between mb-4">
            <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 2fa-code-input">
            <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 2fa-code-input">
            <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 2fa-code-input">
            <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 2fa-code-input">
            <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 2fa-code-input">
            <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 2fa-code-input">
          </div>
          <button id="verify-code-btn" class="w-full bg-primary hover:bg-indigo-700 text-white py-2 rounded-md transition">
            Verify
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 2FA Login Verification Modal -->
  <div id="verify-2fa-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-dark-card rounded-lg w-full max-w-md p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold">Two-Factor Authentication</h2>
        <button id="close-2fa-verify" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="mb-6">
        <p class="mb-4" id="login-2fa-text">Enter the verification code sent to your phone.</p>
        <div class="flex justify-between mb-6">
          <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 login-2fa-input">
          <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 login-2fa-input">
          <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 login-2fa-input">
          <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 login-2fa-input">
          <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 login-2fa-input">
          <input type="text" maxlength="1" class="w-12 h-12 text-center border rounded-md text-2xl dark:bg-gray-700 dark:border-gray-600 login-2fa-input">
        </div>
        <div class="text-center mb-4">
          <span id="2fa-countdown" class="text-sm text-gray-600 dark:text-gray-400">Code expires in: 5:00</span>
        </div>
        <button id="login-verify-btn" class="w-full bg-primary hover:bg-indigo-700 text-white py-2 rounded-md transition mb-3">
          Verify & Login
        </button>
        <button id="resend-code-btn" class="w-full bg-transparent border border-primary text-primary hover:bg-primary hover:text-white py-2 rounded-md transition">
          Resend Code
        </button>
      </div>
    </div>
  </div>
  
  <!-- Backdrop for modals -->
  <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
  
  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-8">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="text-lg font-semibold mb-4">Shop</h3>
          <ul class="space-y-2">
            <li><a href="#" class="hover:text-primary">Deals</a></li>
            <li><a href="#" class="hover:text-primary">New Arrivals</a></li>
            <li><a href="#" class="hover:text-primary">Best Sellers</a></li>
            <li><a href="#" class="hover:text-primary">Gift Cards</a></li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-4">Customer Service</h3>
          <ul class="space-y-2">
            <li><a href="#" class="hover:text-primary">Contact Us</a></li>
            <li><a href="#" class="hover:text-primary">FAQs</a></li>
            <li><a href="#" class="hover:text-primary">Shipping & Returns</a></li>
            <li><a href="#" class="hover:text-primary">Track Order</a></li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-4">About</h3>
          <ul class="space-y-2">
            <li><a href="#" class="hover:text-primary">Our Story</a></li>
            <li><a href="#" class="hover:text-primary">Careers</a></li>
            <li><a href="#" class="hover:text-primary">Press</a></li>
            <li><a href="#" class="hover:text-primary">Privacy Policy</a></li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-4">Connect With Us</h3>
          <div class="flex space-x-4 mb-4">
            <a href="#" class="text-xl hover:text-primary"><i class="fab fa-facebook"></i></a>
            <a href="#" class="text-xl hover:text-primary"><i class="fab fa-X"></i></a>
            <a href="#" class="text-xl hover:text-primary"><i class="fab fa-instagram"></i></a>
            <a href="#" class="text-xl hover:text-primary"><i class="fab fa-tiktok"></i></a>
          </div>
          <p class="text-sm text-gray-400">Sign up for our newsletter to receive updates and exclusive offers.</p>
        </div>
      </div>
      
      <div class="border-t border-gray-700 mt-8 pt-6 flex flex-col md:flex-row justify-between items-center">
        <p class="text-sm text-gray-400 mb-4 md:mb-0">© 2025 Fresh Fusion. All rights reserved.</p>
        <div class="flex space-x-4">
          <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/paypal/paypal-original.svg" alt="PayPal" class="h-8 bg-white rounded p-1">
          <div class="h-8 bg-green-600 text-white font-bold flex items-center justify-center px-2 rounded">M-PESA</div>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // User authentication state
    let isLoggedIn = false;
    let currentUser = null;
    let has2FAEnabled = false;
    let userTwoFactorMethod = null;
    
    // Sample users database (in a real app, this would be server-side)
    const users = [
      {
        id: 1,
        name: "John Doe",
        email: "john@example.com",
        phone: "1234567890",
        password: "password123", // In a real app, this would be hashed
        has2FA: true,
        twoFactorMethod: "sms"
      }
    ];
    
    // Sample product data
    const products = [
      {
        id: 1,
        name: "Wireless Headphones",
        price: 79.99,
        image: "headphones",
        rating: 4.5,
        category: "Electronics"
      },
      {
        id: 2,
        name: "Smart Watch",
        price: 129.99,
        image: "watch",
        rating: 4.2,
        category: "Electronics"
      },
      {
        id: 3,
        name: "Laptop Backpack",
        price: 49.99,
        image: "backpack",
        rating: 4.7,
        category: "Fashion"
      },
      {
        id: 4,
        name: "Bluetooth Speaker",
        price: 39.99,
        image: "speaker",
        rating: 4.0,
        category: "Electronics"
      },
      {
        id: 5,
        name: "Coffee Maker",
        price: 89.99,
        image: "coffee",
        rating: 4.8,
        category: "Home & Kitchen"
      },
      {
        id: 6,
        name: "Fitness Tracker",
        price: 59.99,
        image: "tracker",
        rating: 4.3,
        category: "Sports"
      },
      {
        id: 7,
        name: "Wireless Charger",
        price: 29.99,
        image: "charger",
        rating: 4.1,
        category: "Electronics"
      },
      {
        id: 8,
        name: "Water Bottle",
        price: 19.99,
        image: "bottle",
        rating: 4.6,
        category: "Sports"
      }
    ];
//Putting products into varios categories
    function renderProducts(category = "all") {
      const productsContainer = document.getElementById('products-container');
      productsContainer.innerHTML = '';
      
      products.filter(product => category === "all" || product.category === category)
        .forEach(product => {
          const productElement = document.createElement('div');
          productElement.classList.add('product-card', 'bg-white', 'dark:bg-dark-card', 'rounded-lg', 'shadow-md', 'overflow-hidden', 'p-4');
          
          productElement.innerHTML = `
            <h3 class="text-lg font-semibold">${product.name}</h3>
            <p class="text-gray-700 dark:text-gray-300">$${product.price.toFixed(2)}</p>
            ${product.stock > 0 ? 
              `<button class="bg-primary hover:bg-indigo-700 text-white px-3 py-1 rounded-md">Add to Cart</button>` : 
              `<span class="text-red-500 font-bold">Sold Out</span>`}
          `;
          
          productsContainer.appendChild(productElement);
        });
    }

    document.querySelectorAll('.category-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        renderProducts(tab.dataset.category);
      });
    });
    
    renderProducts();
    
    // Cart functionality
    let cart = [];
    
    function renderProducts() {
      const productsContainer = document.getElementById('products-container');
      productsContainer.innerHTML = '';
      
      products.forEach(product => {
        const productElement = document.createElement('div');
        productElement.classList.add('product-card', 'bg-white', 'dark:bg-dark-card', 'rounded-lg', 'shadow-md', 'overflow-hidden', 'transition-transform');
        
        // Generate a simple product image placeholder
        const iconName = getIconForProduct(product.image);
        
        productElement.innerHTML = `
          <div class="h-48 bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
            <i class="fas ${iconName} text-4xl text-gray-500 dark:text-gray-400"></i>
          </div>
          <div class="p-4">
            <h3 class="text-lg font-semibold mb-1">${product.name}</h3>
            <div class="flex items-center mb-2">
              ${getRatingStars(product.rating)}
              <span class="text-sm text-gray-600 dark:text-gray-400 ml-1">(${product.rating})</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-bold text-lg">$${product.price.toFixed(2)}</span>
              <button 
                class="add-to-cart-btn bg-primary hover:bg-indigo-700 text-white px-3 py-1 rounded-md text-sm transition"
                data-id="${product.id}"
              >
                Add to Cart
              </button>
            </div>
          </div>
        `;
        
        productsContainer.appendChild(productElement);
      });
      
      // Add event listeners to "Add to Cart" buttons
      document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const productId = parseInt(e.target.dataset.id);
          addToCart(productId);
        });
      });
    }
    
    function getIconForProduct(type) {
      const icons = {
        'headphones': 'fa-headphones',
        'watch': 'fa-clock',
        'backpack': 'fa-briefcase',
        'speaker': 'fa-volume-up',
        'coffee': 'fa-coffee',
        'tracker': 'fa-heartbeat',
        'charger': 'fa-battery-full',
        'bottle': 'fa-tint'
      };
      
      return icons[type] || 'fa-box';
    }
    
    function getRatingStars(rating) {
      let stars = '';
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 >= 0.5;
      
      for (let i = 0; i < fullStars; i++) {
        stars += '<i class="fas fa-star text-yellow-400"></i>';
      }
      
      if (hasHalfStar) {
        stars += '<i class="fas fa-star-half-alt text-yellow-400"></i>';
      }
      
      const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
      for (let i = 0; i < emptyStars; i++) {
        stars += '<i class="far fa-star text-yellow-400"></i>';
      }
      
      return stars;
    }
    
    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      
      if (!product) return;
      
      const existingItem = cart.find(item => item.product.id === productId);
      
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          product,
          quantity: 1
        });
      }
      
      updateCartCount();
      renderCart();
      
      // Show feedback
      const addedMsg = document.createElement('div');
      addedMsg.classList.add('fixed', 'bottom-4', 'right-4', 'bg-green-500', 'text-white', 'p-3', 'rounded-md', 'shadow-lg', 'z-50', 'fade-in');
      addedMsg.textContent = `Added ${product.name} to cart`;
      document.body.appendChild(addedMsg);
      
      // Remove after 2 seconds
      setTimeout(() => {
        addedMsg.style.opacity = '0';
        addedMsg.style.transition = 'opacity 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(addedMsg);
        }, 300);
      }, 2000);
    }
    
    function updateCartCount() {
      const cartCount = document.getElementById('cart-count');
      const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
      cartCount.textContent = totalItems;
    }
    
    function renderCart() {
      const cartItems = document.getElementById('cart-items');
      const checkoutItems = document.getElementById('checkout-items');
      const cartTotal = document.getElementById('cart-total');
      const checkoutTotal = document.getElementById('checkout-total');
      
      // Clear cart items container
      cartItems.innerHTML = '';
      
      if (cart.length === 0) {
        cartItems.innerHTML = '<div class="text-center text-gray-500 dark:text-gray-400 py-8">Your cart is empty</div>';
        document.getElementById('checkout-btn').disabled = true;
        document.getElementById('checkout-btn').classList.add('bg-gray-400');
        document.getElementById('checkout-btn').classList.remove('bg-secondary', 'hover:bg-yellow-600');
      } else {
        document.getElementById('checkout-btn').disabled = false;
        document.getElementById('checkout-btn').classList.remove('bg-gray-400');
        document.getElementById('checkout-btn').classList.add('bg-secondary', 'hover:bg-yellow-600');
        
        // Render each cart item
        cart.forEach(item => {
          const itemElement = document.createElement('div');
          itemElement.classList.add('flex', 'justify-between', 'items-center', 'mb-4', 'pb-4', 'border-b', 'border-gray-200', 'dark:border-gray-700');
          
          const iconName = getIconForProduct(item.product.image);
          
          itemElement.innerHTML = `
            <div class="flex items-center">
              <div class="w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded-md flex items-center justify-center mr-3">
                <i class="fas ${iconName} text-gray-500 dark:text-gray-400"></i>
              </div>
              <div>
                <h4 class="font-medium">${item.product.name}</h4>
                <div class="text-sm text-gray-600 dark:text-gray-400">$${item.product.price.toFixed(2)} × ${item.quantity}</div>
              </div>
            </div>
            <div class="flex items-center">
              <div class="mr-4">
                $${(item.product.price * item.quantity).toFixed(2)}
              </div>
              <div class="flex items-center border rounded-md">
                <button 
                  class="decrease-quantity px-2 py-1 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700" 
                  data-id="${item.product.id}"
                >-</button>
                <span class="px-2">${item.quantity}</span>
                <button 
                  class="increase-quantity px-2 py-1 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700" 
                  data-id="${item.product.id}"
                >+</button>
              </div>
              <button 
                class="remove-item ml-3 text-red-500 hover:text-red-700" 
                data-id="${item.product.id}"
              >
                <i class="fas fa-trash"></i>
              </button>
            </div>
          `;
          
          cartItems.appendChild(itemElement);
        });
        
        // Add event listeners
        document.querySelectorAll('.decrease-quantity').forEach(button => {
          button.addEventListener('click', (e) => {
            const productId = parseInt(e.target.dataset.id);
            decreaseQuantity(productId);
          });
        });
        
        document.querySelectorAll('.increase-quantity').forEach(button => {
          button.addEventListener('click', (e) => {
            const productId = parseInt(e.target.dataset.id);
            increaseQuantity(productId);
          });
        });
        
        document.querySelectorAll('.remove-item').forEach(button => {
          button.addEventListener('click', (e) => {
            const productId = parseInt(e.target.dataset.id);
            removeFromCart(productId);
          });
        });
      }
      
      // Update totals
      const totalAmount = cart.reduce((total, item) => total + (item.product.price * item.quantity), 0);
      cartTotal.textContent = `$${totalAmount.toFixed(2)}`;
      checkoutTotal.textContent = `$${totalAmount.toFixed(2)}`;
      
      // Update checkout items
      if (checkoutItems) {
        checkoutItems.innerHTML = '';
        
        cart.forEach(item => {
          const itemElement = document.createElement('div');
          itemElement.classList.add('flex', 'justify-between', 'items-center', 'text-sm', 'pb-2', 'border-b', 'border-gray-200', 'dark:border-gray-700');
          
          itemElement.innerHTML = `
            <span>${item.product.name} × ${item.quantity}</span>
            <span>$${(item.product.price * item.quantity).toFixed(2)}</span>
          `;
          
          checkoutItems.appendChild(itemElement);
        });
      }
    }
    
    function decreaseQuantity(productId) {
      const itemIndex = cart.findIndex(item => item.product.id === productId);
      
      if (itemIndex === -1) return;
      
      if (cart[itemIndex].quantity === 1) {
        removeFromCart(productId);
      } else {
        cart[itemIndex].quantity -= 1;
        updateCartCount();
        renderCart();
      }
    }
    
    function increaseQuantity(productId) {
      const itemIndex = cart.findIndex(item => item.product.id === productId);
      
      if (itemIndex === -1) return;
      
      cart[itemIndex].quantity += 1;
      updateCartCount();
      renderCart();
    }
    
    function removeFromCart(productId) {
      cart = cart.filter(item => item.product.id !== productId);
      updateCartCount();
      renderCart();
    }
    
    // Initialize product listing
    renderProducts();
    
    // Cart toggle
    const cartBtn = document.getElementById('cart-btn');
    const cartSidebar = document.getElementById('cart-sidebar');
    const closeCart = document.getElementById('close-cart');
    const modalBackdrop = document.getElementById('modal-backdrop');
    
    cartBtn.addEventListener('click', () => {
      cartSidebar.classList.remove('translate-x-full');
      modalBackdrop.classList.remove('hidden');
    });
    
    closeCart.addEventListener('click', () => {
      cartSidebar.classList.add('translate-x-full');
      modalBackdrop.classList.add('hidden');
    });
    
    // Checkout functionality
    const checkoutBtn = document.getElementById('checkout-btn');
    const checkoutModal = document.getElementById('checkout-modal');
    const closeCheckout = document.getElementById('close-checkout');
    
    checkoutBtn.addEventListener('click', () => {
      if (cart.length === 0) return;
      
      checkoutModal.classList.remove('hidden');
      cartSidebar.classList.add('translate-x-full');
    });
    
    closeCheckout.addEventListener('click', () => {
      checkoutModal.classList.add('hidden');
      modalBackdrop.classList.add('hidden');
    });
    
    // M-PESA form toggle
    const mpesaRadio = document.getElementById('mpesa');
    const paypalRadio = document.getElementById('paypal');
    const mpesaForm = document.getElementById('mpesa-form');
    
    mpesaRadio.addEventListener('change', () => {
      mpesaForm.classList.remove('hidden');
    });
    
    paypalRadio.addEventListener('change', () => {
      mpesaForm.classList.add('hidden');
    });
    
    // Place order
    const placeOrderBtn = document.getElementById('place-order-btn');
    const successModal = document.getElementById('success-modal');
    
    placeOrderBtn.addEventListener('click', () => {
      // Show loading state
      const originalText = placeOrderBtn.textContent;
      placeOrderBtn.disabled = true;
      placeOrderBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';
      
      // Simulate payment processing
      setTimeout(() => {
        checkoutModal.classList.add('hidden');
        successModal.classList.remove('hidden');
        
        // Reset cart
        cart = [];
        updateCartCount();
        renderCart();
        
        // Reset button
        placeOrderBtn.disabled = false;
        placeOrderBtn.textContent = originalText;
      }, 2000);
    });
    
    // Continue shopping
    const continueShoppingBtn = document.getElementById('continue-shopping');
    
    continueShoppingBtn.addEventListener('click', () => {
      successModal.classList.add('hidden');
      modalBackdrop.classList.add('hidden');
    });
    
    // Close modals when clicking backdrop
    modalBackdrop.addEventListener('click', () => {
      cartSidebar.classList.add('translate-x-full');
      checkoutModal.classList.add('hidden');
      successModal.classList.add('hidden');
      accountModal.classList.add('hidden');
      setup2FAModal.classList.add('hidden');
      verify2FAModal.classList.add('hidden');
      modalBackdrop.classList.add('hidden');
    });
    
    // Account functionality
    const accountBtn = document.getElementById('account-btn');
    const accountStatus = document.getElementById('account-status');
    const accountModal = document.getElementById('account-modal');
    const closeAccount = document.getElementById('close-account');
    const loginTab = document.getElementById('login-tab');
    const registerTab = document.getElementById('register-tab');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const loginBtn = document.getElementById('login-btn');
    const registerBtn = document.getElementById('register-btn');
    const setup2FAModal = document.getElementById('setup-2fa-modal');
    const verify2FAModal = document.getElementById('verify-2fa-modal');
    
    // Update account status based on login state
    function updateAccountStatus() {
      if (isLoggedIn && currentUser) {
        accountStatus.textContent = currentUser.name.split(' ')[0]; // Show first name only
        checkoutBtn.disabled = false;
        checkoutBtn.classList.remove('bg-gray-400');
        checkoutBtn.classList.add('bg-secondary', 'hover:bg-yellow-600');
      } else {
        accountStatus.textContent = 'Account';
      }
    }
    
    // Toggle account modal
    accountBtn.addEventListener('click', () => {
      if (isLoggedIn) {
        // Show user menu or profile
        showUserMenu();
      } else {
        // Show login/register modal
        accountModal.classList.remove('hidden');
        modalBackdrop.classList.remove('hidden');
        
        // Default to login tab
        showLoginTab();
      }
    });
    
    function showUserMenu() {
      // Create a dropdown menu for logged in users
      const existingMenu = document.getElementById('user-menu');
      if (existingMenu) {
        existingMenu.remove();
        return;
      }
      
      const menu = document.createElement('div');
      menu.id = 'user-menu';
      menu.classList.add('absolute', 'right-4', 'top-16', 'mt-2', 'w-48', 'bg-white', 'dark:bg-dark-card', 'rounded-md', 'shadow-lg', 'z-50', 'py-1', 'fade-in');
      
      menu.innerHTML = `
        <div class="px-4 py-2 text-sm text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700">
          <div class="font-medium">Signed in as</div>
          <div class="truncate">${currentUser.email}</div>
        </div>
        <a href="#" id="profile-link" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
          <i class="fas fa-user-circle mr-2"></i> Your Profile
        </a>
        <a href="#" id="orders-link" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
          <i class="fas fa-box mr-2"></i> Your Orders
        </a>
        <a href="#" id="security-link" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
          <i class="fas fa-shield-alt mr-2"></i> Security Settings
        </a>
        <div class="border-t border-gray-200 dark:border-gray-700"></div>
        <a href="#" id="logout-link" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">
          <i class="fas fa-sign-out-alt mr-2"></i> Sign out
        </a>
      `;
      
      document.body.appendChild(menu);
      
      // Position the menu
      const accountBtnRect = accountBtn.getBoundingClientRect();
      menu.style.top = `${accountBtnRect.bottom + window.scrollY}px`;
      menu.style.right = `${window.innerWidth - accountBtnRect.right}px`;
      
      // Add event listeners
      document.getElementById('logout-link').addEventListener('click', (e) => {
        e.preventDefault();
        logout();
        menu.remove();
      });
      
      document.getElementById('security-link').addEventListener('click', (e) => {
        e.preventDefault();
        menu.remove();
        show2FASetupModal();
      });
      
      // Close menu when clicking outside
      document.addEventListener('click', function closeMenu(e) {
        if (!menu.contains(e.target) && e.target !== accountBtn) {
          menu.remove();
          document.removeEventListener('click', closeMenu);
        }
      });
    }
    
    closeAccount.addEventListener('click', () => {
      accountModal.classList.add('hidden');
      modalBackdrop.classList.add('hidden');
    });
    
    // Tab switching
    loginTab.addEventListener('click', showLoginTab);
    registerTab.addEventListener('click', showRegisterTab);
    
    function showLoginTab() {
      loginTab.classList.add('border-primary');
      loginTab.classList.remove('border-transparent', 'text-gray-500');
      registerTab.classList.remove('border-primary');
      registerTab.classList.add('border-transparent', 'text-gray-500');
      
      loginForm.classList.remove('hidden');
      registerForm.classList.add('hidden');
    }
    
    function showRegisterTab() {
      registerTab.classList.add('border-primary');
      registerTab.classList.remove('border-transparent', 'text-gray-500');
      loginTab.classList.remove('border-primary');
      loginTab.classList.add('border-transparent', 'text-gray-500');
      
      registerForm.classList.remove('hidden');
      loginForm.classList.add('hidden');
    }
    
    // Login functionality
    loginBtn.addEventListener('click', () => {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      if (!email || !password) {
        showMessage('Please fill in all fields', 'error');
        return;
      }
      
      // Find user
      const user = users.find(u => u.email === email && u.password === password);
      
      if (!user) {
        showMessage('Invalid email or password', 'error');
        return;
      }
      
      // Check if 2FA is enabled for this user
      if (user.has2FA) {
        // Store user temporarily
        currentUser = user;
        has2FAEnabled = true;
        userTwoFactorMethod = user.twoFactorMethod;
        
        // Show 2FA verification modal
        accountModal.classList.add('hidden');
        show2FAVerificationModal();
      } else {
        // Login successful
        completeLogin(user);
      }
    });
    
    // Function to complete login after 2FA (if needed)
    function completeLogin(user) {
      isLoggedIn = true;
      currentUser = user;
      has2FAEnabled = user.has2FA;
      userTwoFactorMethod = user.twoFactorMethod;
      
      // Update UI
      updateAccountStatus();
      
      // Close modal
      accountModal.classList.add('hidden');
      verify2FAModal.classList.add('hidden');
      modalBackdrop.classList.add('hidden');
      
      // Show success message
      showMessage('Login successful', 'success');
    }
    
    // Register functionality
    registerBtn.addEventListener('click', () => {
      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const phone = document.getElementById('register-phone').value;
      const password = document.getElementById('register-password').value;
      const confirmPassword = document.getElementById('register-confirm-password').value;
      const enable2FA = document.getElementById('enable-2fa').checked;
      
      // Validate
      if (!name || !email || !phone || !password || !confirmPassword) {
        showMessage('Please fill in all fields', 'error');
        return;
      }
      
      if (password !== confirmPassword) {
        showMessage('Passwords do not match', 'error');
        return;
      }
      
      // Check if email is already registered
      if (users.find(u => u.email === email)) {
        showMessage('Email already registered', 'error');
        return;
      }
      
      // Create new user
      const newUser = {
        id: users.length + 1,
        name,
        email,
        phone,
        password,
        has2FA: enable2FA,
        twoFactorMethod: 'sms' // Default to SMS
      };
      
      // Add user to database
      users.push(newUser);
      
      // Set as current user
      currentUser = newUser;
      
      // If 2FA is enabled, show setup
      if (enable2FA) {
        accountModal.classList.add('hidden');
        show2FASetupModal();
      } else {
        // Complete registration
        completeRegistration();
      }
    });
    
    // Function to complete registration
    function completeRegistration() {
      isLoggedIn = true;
      has2FAEnabled = currentUser.has2FA;
      
      // Update UI
      updateAccountStatus();
      
      // Close modals
      accountModal.classList.add('hidden');
      setup2FAModal.classList.add('hidden');
      modalBackdrop.classList.add('hidden');
      
      // Show success message
      showMessage('Registration successful', 'success');
    }
    
    // Logout function
    function logout() {
      isLoggedIn = false;
      currentUser = null;
      has2FAEnabled = false;
      userTwoFactorMethod = null;
      
      // Update UI
      updateAccountStatus();
      
      // Show message
      showMessage('You have been logged out', 'info');
    }
    
    // 2FA Setup functionality
    const close2FASetup = document.getElementById('close-2fa-setup');
    const twoFAMethodSMS = document.getElementById('2fa-sms');
    const twoFAMethodEmail = document.getElementById('2fa-email');
    const twoFAMethodApp = document.getElementById('2fa-app');
    const app2FADetails = document.getElementById('app-2fa-details');
    const twoFAVerifyText = document.getElementById('2fa-verify-text');
    const sendCodeBtn = document.getElementById('send-code-btn');
    const verifyCodeSection = document.getElementById('verify-code-section');
    const verifyCodeBtn = document.getElementById('verify-code-btn');
    
    // Show 2FA setup modal
    function show2FASetupModal() {
      setup2FAModal.classList.remove('hidden');
      modalBackdrop.classList.remove('hidden');
      
      // Default to SMS method
      twoFAMethodSMS.checked = true;
      updateTwoFASetupUI();
    }
    
    close2FASetup.addEventListener('click', () => {
      setup2FAModal.classList.add('hidden');
      modalBackdrop.classList.add('hidden');
    });
    
    // 2FA method selection
    [twoFAMethodSMS, twoFAMethodEmail, twoFAMethodApp].forEach(radio => {
      radio.addEventListener('change', updateTwoFASetupUI);
    });
    
    function updateTwoFASetupUI() {
      if (twoFAMethodApp.checked) {
        app2FADetails.classList.remove('hidden');
        twoFAVerifyText.textContent = 'Enter the verification code from your authenticator app to verify your 2FA setup.';
      } else {
        app2FADetails.classList.add('hidden');
        if (twoFAMethodSMS.checked) {
          twoFAVerifyText.textContent = 'We\'ll send a verification code to your phone number to verify your 2FA setup.';
        } else {
          twoFAVerifyText.textContent = 'We\'ll send a verification code to your email to verify your 2FA setup.';
        }
      }
    }
    
    // Send verification code
    sendCodeBtn.addEventListener('click', () => {
      // Determine selected method
      let method = 'SMS';
      if (twoFAMethodEmail.checked) method = 'Email';
      if (twoFAMethodApp.checked) method = 'Authenticator App';
      
      // Simulate sending code (in a real app, this would be an API call)
      sendCodeBtn.disabled = true;
      sendCodeBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sending...';
      
      setTimeout(() => {
        verifyCodeSection.classList.remove('hidden');
        sendCodeBtn.classList.add('hidden');
        
        // Update user's 2FA method
        if (currentUser) {
          currentUser.twoFactorMethod = method.toLowerCase();
          userTwoFactorMethod = method.toLowerCase();
        }
        
        // Show success message
        if (method !== 'Authenticator App') {
          showMessage(`Verification code sent via ${method}`, 'success');
        }
        
        // Set up code input behavior
        setup2FACodeInputs();
      }, 1500);
    });
    
    // Set up 2FA code input behavior
    function setup2FACodeInputs() {
      const codeInputs = document.querySelectorAll('.2fa-code-input');
      
      codeInputs.forEach((input, index) => {
        // Clear any previous event listeners
        input.replaceWith(input.cloneNode(true));
        
        // Get the fresh element
        const freshInput = document.querySelectorAll('.2fa-code-input')[index];
        
        // Focus first input
        if (index === 0) freshInput.focus();
        
        // Auto-advance to next input
        freshInput.addEventListener('input', function() {
          if (this.value.length === this.maxLength) {
            const nextInput = codeInputs[index + 1];
            if (nextInput) nextInput.focus();
          }
        });
        
        // Handle backspace
        freshInput.addEventListener('keydown', function(e) {
          if (e.key === 'Backspace' && !this.value && index > 0) {
            const prevInput = codeInputs[index - 1];
            prevInput.focus();
          }
        });
      });
    }
    
    // Verify 2FA setup code
    verifyCodeBtn.addEventListener('click', () => {
      const codeInputs = document.querySelectorAll('.2fa-code-input');
      let code = '';
      
      codeInputs.forEach(input => {
        code += input.value;
      });
      
      // Validate code length
      if (code.length !== 6) {
        showMessage('Please enter all 6 digits of the verification code', 'error');
        return;
      }
      
      // Simulate verification (in a real app, this would be an API call)
      verifyCodeBtn.disabled = true;
      verifyCodeBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Verifying...';
      
      setTimeout(() => {
        // Enable 2FA for user
        if (currentUser) {
          currentUser.has2FA = true;
          has2FAEnabled = true;
        }
        
        // Close modal and complete setup
        setup2FAModal.classList.add('hidden');
        modalBackdrop.classList.add('hidden');
        
        // If this was during registration, complete it
        if (!isLoggedIn) {
          completeRegistration();
        } else {
          // Show success message
          showMessage('Two-factor authentication enabled successfully', 'success');
        }
        
        // Reset button
        verifyCodeBtn.disabled = false;
        verifyCodeBtn.textContent = 'Verify';
      }, 1500);
    });
    
    // 2FA Login Verification
    const close2FAVerify = document.getElementById('close-2fa-verify');
    const loginVerifyBtn = document.getElementById('login-verify-btn');
    const resendCodeBtn = document.getElementById('resend-code-btn');
    const login2FAText = document.getElementById('login-2fa-text');
    const twoFACountdown = document.getElementById('2fa-countdown');
    
    // Show 2FA verification modal for login
    function show2FAVerificationModal() {
      verify2FAModal.classList.remove('hidden');
      modalBackdrop.classList.remove('hidden');
      
      // Update text based on method
      if (userTwoFactorMethod === 'email') {
        login2FAText.textContent = 'Enter the verification code sent to your email.';
      } else if (userTwoFactorMethod === 'app') {
        login2FAText.textContent = 'Enter the verification code from your authenticator app.';
      } else {
        login2FAText.textContent = 'Enter the verification code sent to your phone.';
      }
      
      // Set up code input behavior
      setupLogin2FACodeInputs();
      
      // Start countdown timer
      startCountdownTimer();
    }
    
    close2FAVerify.addEventListener('click', () => {
      verify2FAModal.classList.add('hidden');
      modalBackdrop.classList.add('hidden');
      // Reset current user if closing during login flow
      if (!isLoggedIn) {
        currentUser = null;
      }
    });
    
    // Set up login 2FA code input behavior
    function setupLogin2FACodeInputs() {
      const codeInputs = document.querySelectorAll('.login-2fa-input');
      
      codeInputs.forEach((input, index) => {
        // Clear any previous event listeners
        input.replaceWith(input.cloneNode(true));
        
        // Get the fresh element
        const freshInput = document.querySelectorAll('.login-2fa-input')[index];
        
        // Clear previous value
        freshInput.value = '';
        
        // Focus first input
        if (index === 0) freshInput.focus();
        
        // Auto-advance to next input
        freshInput.addEventListener('input', function() {
          if (this.value.length === this.maxLength) {
            const nextInput = codeInputs[index + 1];
            if (nextInput) {
              nextInput.focus();
            } else {
              // If this is the last input, check if we have a full code
              let code = '';
              codeInputs.forEach(input => {
                code += input.value;
              });
              if (code.length === 6) {
                loginVerifyBtn.focus();
              }
            }
          }
        });
        
        // Handle backspace
        freshInput.addEventListener('keydown', function(e) {
          if (e.key === 'Backspace' && !this.value && index > 0) {
            const prevInput = codeInputs[index - 1];
            prevInput.focus();
          }
        });
      });
    }
    
    // Countdown timer for 2FA code expiration
    let countdownInterval;
    
    function startCountdownTimer() {
      let minutes = 5;
      let seconds = 0;
      
      clearInterval(countdownInterval);
      
      countdownInterval = setInterval(() => {
        if (seconds === 0) {
          if (minutes === 0) {
            clearInterval(countdownInterval);
            twoFACountdown.textContent = 'Code expired. Please request a new one.';
            twoFACountdown.classList.add('text-red-500');
            return;
          }
          minutes--;
          seconds = 59;
        } else {
          seconds--;
        }
        
        twoFACountdown.textContent = `Code expires in: ${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
      }, 1000);
    }
    
    // Verify login 2FA code
    loginVerifyBtn.addEventListener('click', () => {
      const codeInputs = document.querySelectorAll('.login-2fa-input');
      let code = '';
      
      codeInputs.forEach(input => {
        code += input.value;
      });
      
      // Validate code length
      if (code.length !== 6) {
        showMessage('Please enter all 6 digits of the verification code', 'error');
        return;
      }
      
      // Simulate verification (in a real app, this would be an API call)
      loginVerifyBtn.disabled = true;
      loginVerifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Verifying...';
      
      setTimeout(() => {
        // Complete login
        if (currentUser) {
          completeLogin(currentUser);
        }
        
        // Reset button
        loginVerifyBtn.disabled = false;
        loginVerifyBtn.textContent = 'Verify & Login';
        
        // Clear countdown
        clearInterval(countdownInterval);
      }, 1500);
    });
    
    // Resend 2FA code
    resendCodeBtn.addEventListener('click', () => {
      // Simulate sending code (in a real app, this would be an API call)
      resendCodeBtn.disabled = true;
      resendCodeBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sending...';
      
      setTimeout(() => {
        // Reset code inputs
        const codeInputs = document.querySelectorAll('.login-2fa-input');
        codeInputs.forEach(input => {
          input.value = '';
        });
        codeInputs[0].focus();
        
        // Reset countdown
        twoFACountdown.classList.remove('text-red-500');
        startCountdownTimer();
        
        // Reset button
        resendCodeBtn.disabled = false;
        resendCodeBtn.textContent = 'Resend Code';
        
        // Show success message
        showMessage('Verification code resent', 'success');
      }, 1500);
    });
    
    // Utility function to show toast messages
    function showMessage(message, type = 'info') {
      const toast = document.createElement('div');
      
      // Set base classes
      toast.classList.add('fixed', 'bottom-4', 'left-1/2', 'transform', '-translate-x-1/2', 'p-3', 'rounded-md', 'shadow-lg', 'z-50', 'fade-in', 'flex', 'items-center');
      
      // Set type-specific classes
      if (type === 'error') {
        toast.classList.add('bg-red-500', 'text-white');
        toast.innerHTML = '<i class="fas fa-exclamation-circle mr-2"></i>';
      } else if (type === 'success') {
        toast.classList.add('bg-green-500', 'text-white');
        toast.innerHTML = '<i class="fas fa-check-circle mr-2"></i>';
      } else {
        toast.classList.add('bg-blue-500', 'text-white');
        toast.innerHTML = '<i class="fas fa-info-circle mr-2"></i>';
      }
      
      toast.innerHTML += message;
      document.body.appendChild(toast);
      
      // Remove after 3 seconds
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }
    
    // Add checkout login check
    const originalCheckoutClick = checkoutBtn.onclick;
    checkoutBtn.onclick = function(e) {
      if (!isLoggedIn) {
        e.preventDefault();
        showMessage('Please sign in to proceed to checkout', 'info');
        accountModal.classList.remove('hidden');
        modalBackdrop.classList.remove('hidden');
        return;
      }
      
      if (originalCheckoutClick) {
        originalCheckoutClick.call(this, e);
      } else if (cart.length > 0) {
        checkoutModal.classList.remove('hidden');
        cartSidebar.classList.add('translate-x-full');
      }
    };
    
    // Initialize user interface
    updateAccountStatus();
  </script>
</body>
</html>
